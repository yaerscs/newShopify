<div class="product-faq" {{ block.shopify_attributes }}>
  <div class="faq-container">
    {% assign items_to_show = items_limit | default: 100 %}
    {% assign item_count = 0 %}
    
    {% comment %} Support for blocks-based format {% endcomment %}
    {% if blocks %}
      {% for faq_block in blocks %}
        {% if item_count < items_to_show %}
          <div class="faq-item">
            <div class="faq-question">
              {% if faq_block.settings.question_image %}
                <div class="faq-question-image" style="width: {{ image_size | default: 40 }}px; height: {{ image_size | default: 40 }}px;">
                  {{ faq_block.settings.question_image | image_url: width: image_size | default: 40 | image_tag: loading: 'lazy', alt: faq_block.settings.question }}
                </div>
              {% endif %}
              <span class="faq-question-text">{{ faq_block.settings.question }}</span>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              {{ faq_block.settings.answer }}
            </div>
          </div>
          {% assign item_count = item_count | plus: 1 %}
        {% endif %}
      {% endfor %}
    {% endif %}
    
    {% comment %} Support for legacy format with question_1 through question_5 {% endcomment %}
    {% if block %}
      {% for i in (1..6) %}
        {% assign question_key = 'question_' | append: i %}
        {% assign answer_key = 'answer_' | append: i %}
        {% assign image_key = 'question_' | append: i | append: '_image' %}
        
        {% assign question = block.settings[question_key] %}
        {% assign answer = block.settings[answer_key] %}
        {% assign question_image = block.settings[image_key] %}
        
        {% if question != blank and item_count < items_to_show %}
          <div class="faq-item">
            <div class="faq-question">
              {% if question_image %}
                <div class="faq-question-image" style="width: {{ image_size | default: 40 }}px; height: {{ image_size | default: 40 }}px;">
                  {{ question_image | image_url: width: image_size | default: 40 | image_tag: loading: 'lazy', alt: question }}
                </div>
              {% endif %}
              <span class="faq-question-text">{{ question }}</span>
              <span class="faq-toggle">+</span>
            </div>
            <div class="faq-answer">
              {{ answer }}
            </div>
          </div>
          {% assign item_count = item_count | plus: 1 %}
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
</div>

<style>
.product-faq {
  width: 100%;
  margin: {{ margin_top | default: 20 }}px auto {{ margin_bottom | default: 20 }}px;
  font-size: 95%;
}

.faq-container {
  border-radius: {{ border_radius | default: 8 }}px;
  overflow: hidden;
  border: 1px solid {{ border_color | default: '#e0e0e0' }};
  background-color: {{ question_bg_color | default: '#ffffff' }};
}

.faq-item {
  border-bottom: 1px solid {{ border_color | default: '#e0e0e0' }};
  padding: 0;
}

.faq-item:last-child {
  border-bottom: none;
}

.faq-question {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  cursor: pointer;
  font-weight: var(--font-weight-regular);
  position: relative;
  color: {{ question_color | default: '#333333' }};
  background-color: transparent;
  font-size: 15px;
  line-height: 1.3;
}

.faq-question-image {
  margin-right: 12px;
  flex-shrink: 0;
  width: {{ image_size | default: 40 }}px;
  height: {{ image_size | default: 40 }}px;
  border-radius: {{ image_border_radius | default: 4 }}px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

.faq-question-image img {
  width: 100%;
  height: 100%;
  object-fit: {{ image_fit | default: 'cover' }};
}

.faq-question-text {
  flex: 1;
}

.faq-toggle {
  font-size: 18px;
  font-weight: var(--font-weight-regular);
  transition: transform 0.3s ease;
  margin-left: 10px;
  flex-shrink: 0;
}

.faq-answer {
  padding: 0 16px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
  color: {{ answer_color | default: '#555555' }};
  background-color: transparent;
  font-size: 14px;
  line-height: 1.4;
}

.faq-item.active .faq-toggle {
  transform: rotate(45deg);
}

.faq-item.active .faq-answer {
  max-height: 2000px;
  padding: 0 16px 12px;
  overflow: visible;
}

.faq-answer::-webkit-scrollbar {
  width: 6px;
}
.faq-answer::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.1);
  border-radius: 3px;
}
.faq-answer::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 3px;
}
.faq-answer::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.5);
}

@media screen and (max-width: 768px) {
  .product-faq {
    font-size: 90%;
    width: 100%;
  }
  
  .faq-question {
    padding: 10px 14px;
    font-size: 14px;
  }
  
  .faq-question-image {
    width: {{ image_size | default: 40 | times: 0.875 }}px;
    height: {{ image_size | default: 40 | times: 0.875 }}px;
    margin-right: 10px;
  }
  
  .faq-toggle {
    font-size: 16px;
  }
  
  .faq-answer {
    padding: 0 14px;
    font-size: 14px;
  }
  
  .faq-item.active .faq-answer {
    max-height: 2000px;
    padding: 0 14px 10px;
  }

  .faq-answer::-webkit-scrollbar {
    width: 4px;
  }
}

@media screen and (max-width: 480px) {
  .product-faq {
    font-size: 85%;
    width: 100%;
    margin: {{ margin_top | default: 20 | times: 0.8 }}px auto {{ margin_bottom | default: 20 | times: 0.8 }}px;
  }
  
  .faq-question {
    padding: 8px 12px;
    font-size: 14px;
  }
  
  .faq-question-image {
    width: {{ image_size | default: 40 | times: 0.75 }}px;
    height: {{ image_size | default: 40 | times: 0.75 }}px;
    margin-right: 8px;
  }
  
  .faq-toggle {
    font-size: 14px;
  }
  
  .faq-answer {
    padding: 0 12px;
    font-size: 14px;
    line-height: 1.3;
  }
  
  .faq-item.active .faq-answer {
    max-height: 2000px;
    padding: 0 12px 8px;
  }

  .faq-answer::-webkit-scrollbar {
    width: 3px;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const faqContainer = document.querySelector('.product-faq');
  if (!faqContainer) return;

  const faqItems = faqContainer.querySelectorAll('.faq-item');
  
  faqItems.forEach((item) => {
    const question = item.querySelector('.faq-question');
    if (!question) return;

    question.addEventListener('click', function () {
      const isActive = item.classList.contains('active');
      
      // Close all other items (accordion mode)
      faqItems.forEach((otherItem) => {
        if (otherItem !== item) {
          otherItem.classList.remove('active');
        }
      });

      // Toggle the current item
      item.classList.toggle('active');
    });
  });
});
</script>
